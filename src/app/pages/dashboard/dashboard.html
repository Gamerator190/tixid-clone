<div class="dashboard">
  <header class="top-bar">
    <div class="brand">
      <div class="logo">PLAN<span>FUN</span></div>
    </div>

    <div class="top-actions">
      <button class="notif-btn" type="button" (click)="openNotifications()" title="Notifikasi">
        üîî @if (unreadCount > 0) {
        <span class="notification-badge">{{ unreadCount }}</span>
        }
      </button>

      <div class="user-pill" (click)="toggleUserMenu()">
        <div class="avatar-wrap">
          <div class="avatar-glow"></div>
          <div class="avatar">{{ userName[0] || 'A' }}</div>
        </div>

        <div class="user-meta">
          <div class="hello">Hi üëã</div>
          <div class="name">{{ userName }}</div>
        </div>

        <div class="icon">
          <span>‚ñæ</span>
        </div>
      </div>
    </div>

    <div class="user-menu" *ngIf="showMenu">
      <div class="menu-item" (click)="goHome()">Homepage</div>
      <div class="menu-item" (click)="goToForgotPassword()">
        Forgot Password
      </div>
      <div class="menu-item" (click)="logout()">Logout</div>
    </div>
  </header>

  <main class="dashboard-content">
    <div class="dashboard-header">
      <h1 class="content-title">Event Organizer Dashboard</h1>
      <p class="content-subtitle">Manage events and system analytics</p>
    </div>

    <div class="action-buttons">
      <button class="btn" (click)="showChoice('analytics-reports')">üìä Analytics Reports</button>
      <button class="btn" (click)="showChoice('create-event')">‚ûï Create Event</button>
      <button class="btn" (click)="showChoice('edit-event')">‚úèÔ∏è Edit Event</button>
    </div>

    @if(activeChoice === 'create-event') {
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Create New Event</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="event-title">Event Title</label>
            <input type="text" id="event-title" name="event-title" placeholder="Enter event name" />
          </div>
          <div class="form-group">
            <label for="event-location">Event Location</label>
            <input
              type="text"
              id="event-location"
              name="event-location"
              placeholder="e.g., Main Auditorium"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="event-date">Event Date</label>
            <input type="date" id="event-date" name="event-date" />
          </div>
          <div class="form-group">
            <label for="event-time">Event Time</label>
            <input type="time" id="event-time" name="event-time" />
          </div>
        </div>

        <div class="form-group">
          <label for="event-description">Event Description</label>
          <textarea
            id="event-description"
            name="event-description"
            placeholder="Enter event details and description..."
          ></textarea>
        </div>

        <div class="form-group">
          <label for="event-poster">Event Poster (Optional)</label>
          <input type="file" id="event-poster" name="event-poster" accept="image/*" />
        </div>

        <div class="form-actions">
          <button class="form-btn form-btn-submit" type="button" (click)="submitForm()">
            Create Event
          </button>
          <button class="form-btn form-btn-cancel" type="button" (click)="showChoice('')">
            Cancel
          </button>
        </div>
      </div>
    </div>
    }

    @else if(activeChoice === 'edit-event') {
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Edit Event</h2>

        <div class="form-group">
          <label for="select-event">Select Event to Edit</label>
          <select
            id="select-event"
            name="select-event"
            [(ngModel)]="selectedEventId"
            (change)="onEventSelect($event)"
          >
            <option [value]="null">Choose an event...</option>
            <option *ngFor="let event of userEvents" [value]="event._id">{{ event.title }}</option>
          </select>
        </div>

        @if (!selectedEventId) {
        <div class="placeholder-content">
          <div class="placeholder-icon">üìù</div>
          <p class="placeholder-text">Select an event to begin editing</p>
        </div>
        } @else {
        <div class="form-row">
          <div class="form-group">
            <label for="edit-event-title">Event Title</label>
            <input type="text" id="edit-event-title" [(ngModel)]="editTitle" name="edit-event-title" placeholder="Enter event name" />
          </div>
          <div class="form-group">
            <label for="edit-event-location">Event Location</label>
            <input
              type="text"
              id="edit-event-location"
              [(ngModel)]="editLocation"
              name="edit-event-location"
              placeholder="e.g., Main Auditorium"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="edit-event-date">Event Date</label>
            <input type="date" id="edit-event-date" [(ngModel)]="editDate" name="edit-event-date" />
          </div>
          <div class="form-group">
            <label for="edit-event-time">Event Time</label>
            <input type="time" id="edit-event-time" [(ngModel)]="editTime" name="edit-event-time" />
          </div>
        </div>

        <div class="form-group">
          <label for="edit-event-description">Event Description</label>
          <textarea
            id="edit-event-description"
            [(ngModel)]="editDescription"
            name="edit-event-description"
            placeholder="Enter event details and description..."
          ></textarea>
        </div>

        <div class="form-group">
          <label for="edit-event-poster">Event Poster (Optional)</label>
          <input type="file" id="edit-event-poster" name="edit-event-poster" accept="image/*" />
        </div>

        <div class="card-subtitle">Add Ticket Types</div>
        <div *ngFor="let category of ticketCategories; let i = index" class="category-form-row">
          <div class="form-group">
            <label>Category Name</label>
            <input
              type="text"
              [(ngModel)]="category.name"
              name="cat-name-{{i}}"
              placeholder="e.g., General Admission"
            />
          </div>
          <div class="form-group">
            <label>Short Name</label>
            <input
              type="text"
              [(ngModel)]="category.shortName"
              name="cat-short-name-{{i}}"
              placeholder="e.g., GEN"
            />
          </div>
          <div class="form-group">
            <label>Price (Rp)</label>
            <input
              type="number"
              [(ngModel)]="category.price"
              name="cat-price-{{i}}"
              placeholder="e.g., 50000"
            />
          </div>
          <div class="form-group">
            <label>Max Tickets</label>
            <input
              type="number"
              [(ngModel)]="category.maxTickets"
              name="cat-max-{{i}}"
              placeholder="e.g., 100"
            />
          </div>
          <button
            type="button"
            (click)="removeCategory(i)"
            class="form-group form-btn-remove"
            [disabled]="ticketCategories.length === 1"
          >
            Remove
          </button>
        </div>
        <button type="button" (click)="addCategory()" class="form-btn-add">+ Add Category</button>

        <div class="card-subtitle">Seat Row Configuration</div>
        <div class="seat-config-grid">
          <div *ngFor="let config of seatConfiguration" class="form-group">
            <label>{{config.row}}</label>
            <select
              [(ngModel)]="config.category"
              name="seat-row-{{config.row}}"
              (change)="updateSeatConfiguration()"
            >
              <option *ngFor="let cat of ticketCategories" [value]="cat.shortName">
                {{cat.name}} ({{cat.shortName}})
              </option>
            </select>
          </div>
        </div>

        <div class="card-subtitle">Promos</div>
        <div *ngFor="let promo of promo; let i = index" class="promo-form-row">
          <div class="form-group">
            <label>Promo Code</label>
            <input type="text" [(ngModel)]="promo.code" name="promo-code-{{i}}" />
          </div>
          <div class="form-group">
            <label>Discount %</label>
            <input type="number" [(ngModel)]="promo.discountPercent" name="promo-discount-{{i}}" />
          </div>
          <div class="form-group">
            <label>Expiry Date</label>
            <input type="date" [(ngModel)]="promo.expiryDate" name="promo-expiry-{{i}}" />
          </div>
          <div class="form-group applicable-types">
            <label>Applicable To</label>
            <div *ngFor="let cat of ticketCategories" class="checkbox-group">
              <input
                type="checkbox"
                [(ngModel)]="promo.applicableTicketTypes[cat.shortName]"
                name="promo-cat-{{i}}-{{cat.shortName}}"
              />
              <span>{{cat.shortName}}</span>
            </div>
          </div>
          <button type="button" (click)="removePromo(i)" class="form-btn-remove">Remove</button>
        </div>
        <button type="button" (click)="addPromo()" class="form-btn-add">+ Add Promo</button>

        <div class="card-subtitle">Seating Map</div>
        <app-seat-picker
          [ticketCategories]="ticketCategories"
          [seatConfiguration]="seatConfiguration"
          [bookedSeats]="bookedSeats"
          [showContinueButton]="false"
        >
        </app-seat-picker>
        }

        <div class="form-actions">
          <button class="form-btn form-btn-submit" type="button" (click)="submitForm()">
            Update Event
          </button>
          <button class="form-btn form-btn-cancel" type="button" (click)="showChoice('')">
            Cancel
          </button>
        </div>
      </div>
    </div>
    }
    
    @else if(activeChoice === 'analytics-reports') {
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">Analytics & Reports</h2>

        <div class="form-group">
          <label for="report-type">Report Type</label>
          <select id="report-type" [(ngModel)]="reportType" name="reportType" (change)="generateReport()">
            <option value="ticketSales">Ticket Sales</option>
            <option value="revenue">Revenue</option>
            <option value="seatOccupancy">Seat Occupancy</option>
          </select>
        </div>

        <div class="form-group">
          <label for="reporting-period">Reporting Period</label>
          <select id="reporting-period" [(ngModel)]="reportingPeriod" name="reportingPeriod" (change)="generateReport()">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div class="form-actions">
          <button class="form-btn form-btn-submit" type="button" (click)="generateReport()">
            Generate Report
          </button>
          <button
            class="form-btn form-btn-cancel"
            type="button"
            (click)="downloadReportAsPdf()"
            [disabled]="!generatedReportData"
          >
            Download PDF
          </button>
          <button class="form-btn form-btn-cancel" type="button" (click)="showChoice('')">
            Close
          </button>
        </div>

        @if (insufficientDataMessage) {
        <div class="report-message error">{{ insufficientDataMessage }}</div>
        }
        <div class="report-display" [hidden]="!generatedReportData">
          <h3>
            {{ generatedReportData?.type | titlecase }} Report ({{ generatedReportData?.period |
            titlecase }})
          </h3>

          <div class="report-table">
            <table>
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of generatedReportData?.tableData">
                  <td>{{ row.label }}</td>
                  <td>{{ row.value }}</td>
                </tr>
              </tbody>
            </table>
          </div>


                    <div class="report-chart">

                      <canvas #reportChart></canvas>

                    </div>

                  </div>

                </div>

              </div>

              }
  </main>
</div>
